<div>
    <h5 class="card-title">Calendar View</h5>
    <div>
        <div class="d-flex justify-content-between align-items-start mb-4">
            <div class="btn-group">
                <button class="btn btn-outline-primary" id="prevMonth">&lt;</button>
                <button class="btn btn-outline-primary" id="currentMonth"></button>
                <button class="btn btn-outline-primary" id="nextMonth">&gt;</button>
            </div>
            <div class="button-panel">
                <button class="btn btn-outline-primary w-100" id="todayButton">Today</button>
            </div>
        </div>
    
        <div class="calendar-container">
            <div class="calendar-header d-flex">
                <div class="calendar-cell">Sun</div>
                <div class="calendar-cell">Mon</div>
                <div class="calendar-cell">Tue</div>
                <div class="calendar-cell">Wed</div>
                <div class="calendar-cell">Thu</div>
                <div class="calendar-cell">Fri</div>
                <div class="calendar-cell">Sat</div>
            </div>
            <div id="calendar-body"></div>
        </div>

        <div class="modal fade" id="monthYearModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Select Month & Year</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="d-flex justify-content-center align-items-center mb-3">
                            <button class="btn btn-outline-secondary me-2" id="prevYear">&lt;</button>
                            <span id="yearDisplay" class="h4 mb-0"></span>
                            <button class="btn btn-outline-secondary ms-2" id="nextYear">&gt;</button>
                        </div>
                        <div class="month-grid" id="monthGrid"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <style>
        .calendar-container {
            border: 1px solid #dee2e6;
        }
        .calendar-cell {
            flex: 1;
            min-height: 100px;
            border: 1px solid #dee2e6;
            padding: 8px;
        }
        .calendar-header .calendar-cell {
            min-height: auto;
            padding: 10px;
            text-align: center;
            background-color: #f8f9fa;
            font-weight: bold;
        }
        .calendar-row {
            display: flex;
        }
        .session-dot {
            height: 8px;
            width: 8px;
            background-color: #007bff;
            border-radius: 50%;
            display: inline-block;
            margin-right: 4px;
        }
        .session-item {
            font-size: 0.8rem;
            padding: 2px 4px;
            margin: 2px 0;
            background-color: #e9ecef;
            border-radius: 3px;
            cursor: pointer;
        }
        .button-panel {
            width: 120px;
            margin-left: 16px;
        }
        .month-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding: 15px;
        }
        .month-item {
            padding: 10px;
            text-align: center;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
        }
        .month-item:hover {
            background-color: #f8f9fa;
        }
        .month-item.selected {
            background-color: #007bff;
            color: white;
        }
    </style>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let currentDate = new Date();
            const sessions = {{ all_course_sessions|tojson|safe }};
            const monthYearModal = new bootstrap.Modal(document.getElementById('monthYearModal'));
            const months = ['January', 'February', 'March', 'April', 'May', 'June',
                          'July', 'August', 'September', 'October', 'November', 'December'];
            
            function renderCalendar(date) {
                const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
                const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
                
                document.getElementById('currentMonth').textContent = 
                    date.toLocaleString('default', { month: 'long', year: 'numeric' });
                
                const calendarBody = document.getElementById('calendar-body');
                calendarBody.innerHTML = '';
                
                let currentRow = document.createElement('div');
                currentRow.className = 'calendar-row';
                
                // Add empty cells for days before first of month
                for(let i = 0; i < firstDay.getDay(); i++) {
                    const cell = document.createElement('div');
                    cell.className = 'calendar-cell';
                    currentRow.appendChild(cell);
                }
                
                for(let day = 1; day <= lastDay.getDate(); day++) {
                    if(currentRow.children.length === 7) {
                        calendarBody.appendChild(currentRow);
                        currentRow = document.createElement('div');
                        currentRow.className = 'calendar-row';
                    }
                    
                    const cell = document.createElement('div');
                    cell.className = 'calendar-cell';
                    cell.innerHTML = `<div>${day}</div>`;
                    
                    // Add sessions for this day
                    const currentDateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const daySessions = sessions.filter(session => session.date === currentDateStr);
                    
                    daySessions.forEach(session => {
                        const sessionEl = document.createElement('div');
                        sessionEl.className = 'session-item';
                        sessionEl.innerHTML = `<span class="session-dot"></span>${session.course.name} - ${session.start_time}`;
                        cell.appendChild(sessionEl);
                    });
                    
                    currentRow.appendChild(cell);
                }
                
                // Fill remaining cells
                while(currentRow.children.length < 7) {
                    const cell = document.createElement('div');
                    cell.className = 'calendar-cell';
                    currentRow.appendChild(cell);
                }
                calendarBody.appendChild(currentRow);
            }
            
            document.getElementById('prevMonth').addEventListener('click', () => {
                currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1);
                renderCalendar(currentDate);
            });
            
            document.getElementById('nextMonth').addEventListener('click', () => {
                currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1);
                renderCalendar(currentDate);
            });
            
            document.getElementById('todayButton').addEventListener('click', () => {
                currentDate = new Date();
                renderCalendar(currentDate);
            });

            function renderMonthGrid() {
                const monthGrid = document.getElementById('monthGrid');
                monthGrid.innerHTML = '';
                document.getElementById('yearDisplay').textContent = currentDate.getFullYear();
                
                months.forEach((month, index) => {
                    const monthElement = document.createElement('div');
                    monthElement.className = 'month-item';
                    if (index === currentDate.getMonth()) {
                        monthElement.classList.add('selected');
                    }
                    monthElement.textContent = month;
                    monthElement.addEventListener('click', () => {
                        currentDate.setMonth(index);
                        renderCalendar(currentDate);
                        monthYearModal.hide();
                    });
                    monthGrid.appendChild(monthElement);
                });
            }

            document.getElementById('currentMonth').addEventListener('click', () => {
                renderMonthGrid();
                monthYearModal.show();
            });

            document.getElementById('prevYear').addEventListener('click', () => {
                currentDate.setFullYear(currentDate.getFullYear() - 1);
                renderMonthGrid();
            });

            document.getElementById('nextYear').addEventListener('click', () => {
                currentDate.setFullYear(currentDate.getFullYear() + 1);
                renderMonthGrid();
            });
            
            renderCalendar(currentDate);
        });
    </script>
</div>